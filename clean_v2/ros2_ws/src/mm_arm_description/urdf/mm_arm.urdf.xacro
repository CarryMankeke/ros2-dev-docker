<?xml version="1.0"?>
<!-- Autor: Camilo Soto Villegas | Contacto: camilo.soto.v@usach.cl | Proyecto: clean_v2 -->
<robot name="mm_arm" xmlns:xacro="http://www.ros.org/wiki/xacro">
  <xacro:include filename="$(find mm_arm_description)/urdf/mm_arm_macro.xacro"/>

  <xacro:arg name="prefix" default="mm1_"/>
  <xacro:arg name="namespace" default="mm1/arm"/>
  <xacro:arg name="scale" default="1.0"/>
  <xacro:arg name="controllers_file" default=""/>
  <xacro:arg name="enable_ros2_control" default="true"/>
  <xacro:arg name="arm_mount_height" default="0.02"/>
  <xacro:arg name="visual_mode" default="full"/>
  <xacro:arg name="ee_cam_mount_x" default="0.055"/>
  <xacro:arg name="ee_cam_mount_y" default="0.0"/>
  <xacro:arg name="ee_cam_mount_z" default="0.02"/>
  <xacro:arg name="ee_cam_mount_roll" default="0.0"/>
  <xacro:arg name="ee_cam_mount_pitch" default="0.0"/>
  <xacro:arg name="ee_cam_mount_yaw" default="0.0"/>
  <xacro:arg name="ee_cam_x" default="0.035"/>
  <xacro:arg name="ee_cam_y" default="0.0"/>
  <xacro:arg name="ee_cam_z" default="0.0"/>
  <xacro:arg name="ee_cam_roll" default="0.0"/>
  <xacro:arg name="ee_cam_pitch" default="0.0"/>
  <xacro:arg name="ee_cam_yaw" default="0.0"/>
  <xacro:arg name="enable_ee_imu" default="true"/>
  <xacro:arg name="ee_imu_x" default="0.03"/>
  <xacro:arg name="ee_imu_y" default="0.0"/>
  <xacro:arg name="ee_imu_z" default="0.02"/>
  <xacro:arg name="ee_imu_roll" default="0.0"/>
  <xacro:arg name="ee_imu_pitch" default="0.0"/>
  <xacro:arg name="ee_imu_yaw" default="0.0"/>

  <xacro:property name="prefix" value="$(arg prefix)"/>
  <xacro:property name="namespace" value="$(arg namespace)"/>
  <xacro:property name="scale" value="$(arg scale)"/>
  <xacro:property name="controllers_file" value="$(arg controllers_file)"/>

  <xacro:mm_arm
    prefix="${prefix}"
    scale="${scale}"
    arm_mount_height="$(arg arm_mount_height)"
    visual_mode="$(arg visual_mode)"
    ee_cam_mount_x="$(arg ee_cam_mount_x)"
    ee_cam_mount_y="$(arg ee_cam_mount_y)"
    ee_cam_mount_z="$(arg ee_cam_mount_z)"
    ee_cam_mount_roll="$(arg ee_cam_mount_roll)"
    ee_cam_mount_pitch="$(arg ee_cam_mount_pitch)"
    ee_cam_mount_yaw="$(arg ee_cam_mount_yaw)"
    ee_cam_x="$(arg ee_cam_x)"
    ee_cam_y="$(arg ee_cam_y)"
    ee_cam_z="$(arg ee_cam_z)"
    ee_cam_roll="$(arg ee_cam_roll)"
    ee_cam_pitch="$(arg ee_cam_pitch)"
    ee_cam_yaw="$(arg ee_cam_yaw)"
    enable_ee_imu="$(arg enable_ee_imu)"
    ee_imu_x="$(arg ee_imu_x)"
    ee_imu_y="$(arg ee_imu_y)"
    ee_imu_z="$(arg ee_imu_z)"
    ee_imu_roll="$(arg ee_imu_roll)"
    ee_imu_pitch="$(arg ee_imu_pitch)"
    ee_imu_yaw="$(arg ee_imu_yaw)"
  />

  <xacro:if value="$(arg enable_ros2_control)">
    <xacro:if value="$(eval controllers_file != '')">
      <ros2_control name="mm_arm_system" type="system">
        <hardware>
          <plugin>gz_ros2_control/GazeboSimSystem</plugin>
        </hardware>

        <joint name="${prefix}arm_shoulder_pan_joint">
          <command_interface name="position"/>
          <state_interface name="position"/>
          <state_interface name="velocity"/>
        </joint>
        <joint name="${prefix}arm_shoulder_lift_joint">
          <command_interface name="position"/>
          <state_interface name="position"/>
          <state_interface name="velocity"/>
        </joint>
        <joint name="${prefix}arm_elbow_joint">
          <command_interface name="position"/>
          <state_interface name="position"/>
          <state_interface name="velocity"/>
        </joint>
        <joint name="${prefix}arm_wrist_1_joint">
          <command_interface name="position"/>
          <state_interface name="position"/>
          <state_interface name="velocity"/>
        </joint>
        <joint name="${prefix}arm_wrist_2_joint">
          <command_interface name="position"/>
          <state_interface name="position"/>
          <state_interface name="velocity"/>
        </joint>
        <joint name="${prefix}arm_wrist_3_joint">
          <command_interface name="position"/>
          <state_interface name="position"/>
          <state_interface name="velocity"/>
        </joint>
        <joint name="${prefix}gripper_joint">
          <command_interface name="position"/>
          <state_interface name="position"/>
          <state_interface name="velocity"/>
        </joint>
      </ros2_control>

      <gazebo>
        <plugin filename="libgz_ros2_control-system.so" name="gz_ros2_control::GazeboSimROS2ControlPlugin">
          <ros>
            <namespace>$(arg namespace)</namespace>
          </ros>
          <parameters>${controllers_file}</parameters>
          <controller_manager_name>controller_manager</controller_manager_name>
        </plugin>
      </gazebo>
    </xacro:if>
  </xacro:if>
</robot>
